import{a as N}from"./chunk-6GFTAZEO.js";import{b as H}from"./chunk-VITXMWK4.js";import{Q as M,R as V,T as I,U as w}from"./chunk-QOA5MJ5H.js";import{Fc as P,fa as k,ja as $}from"./chunk-QS6W74OU.js";import{a as x,b as U}from"./chunk-2NFLSA4Y.js";var L=class r{constructor(c){this.http=c}apiUrl="/api/srs";submitReview(c){return console.log(`SERVICE: Submitting review for flashcard ${c.flashcardActivityPubId} with rating ${c.rating}`),this.http.post(`${this.apiUrl}/review`,c)}addToReview(c){return this.http.post(`${this.apiUrl}/add`,c)}getDueFlashcards(){return console.log("SERVICE: Fetching due flashcards from API..."),this.http.get(`${this.apiUrl}/due`)}static \u0275fac=function(l){return new(l||r)($(H))};static \u0275prov=k({token:r,factory:r.\u0275fac})};function z(){return{ids:[],entities:{}}}function G(){function r(c={}){return Object.assign(z(),c)}return{getInitialState:r}}function J(){function r(c){let l=p=>p.ids,y=p=>p.entities,h=M(l,y,(p,E)=>p.map(S=>E[S])),m=M(l,p=>p.length);return c?{selectIds:M(c,l),selectEntities:M(c,y),selectAll:M(c,h),selectTotal:M(c,m)}:{selectIds:l,selectEntities:y,selectAll:h,selectTotal:m}}return{getSelectors:r}}var o=function(r){return r[r.EntitiesOnly=0]="EntitiesOnly",r[r.Both=1]="Both",r[r.None=2]="None",r}(o||{});function d(r){return function(l,y){let h={ids:[...y.ids],entities:x({},y.entities)},m=r(l,h);return m===o.Both?Object.assign({},y,h):m===o.EntitiesOnly?U(x({},y),{entities:h.entities}):y}}function b(r,c){let l=c(r);return P()&&l===void 0&&console.warn("@ngrx/entity: The entity passed to the `selectId` implementation returned undefined.","You should probably provide your own `selectId` implementation.","The entity that was passed:",r,"The `selectId` implementation:",c.toString()),l}function D(r){function c(a,n){let e=b(a,r);return e in n.entities?o.None:(n.ids.push(e),n.entities[e]=a,o.Both)}function l(a,n){let e=!1;for(let t of a)e=c(t,n)!==o.None||e;return e?o.Both:o.None}function y(a,n){return n.ids=[],n.entities={},l(a,n),o.Both}function h(a,n){let e=b(a,r);return e in n.entities?(n.entities[e]=a,o.EntitiesOnly):(n.ids.push(e),n.entities[e]=a,o.Both)}function m(a,n){let e=a.map(t=>h(t,n));switch(!0){case e.some(t=>t===o.Both):return o.Both;case e.some(t=>t===o.EntitiesOnly):return o.EntitiesOnly;default:return o.None}}function p(a,n){return E([a],n)}function E(a,n){let t=(a instanceof Array?a:n.ids.filter(i=>a(n.entities[i]))).filter(i=>i in n.entities).map(i=>delete n.entities[i]).length>0;return t&&(n.ids=n.ids.filter(i=>i in n.entities)),t?o.Both:o.None}function S(a){return Object.assign({},a,{ids:[],entities:{}})}function R(a,n,e){let t=e.entities[n.id],i=Object.assign({},t,n.changes),s=b(i,r),u=s!==n.id;return u&&(a[n.id]=s,delete e.entities[n.id]),e.entities[s]=i,u}function B(a,n){return v([a],n)}function v(a,n){let e={};return a=a.filter(i=>i.id in n.entities),a.length>0?a.filter(s=>R(e,s,n)).length>0?(n.ids=n.ids.map(s=>e[s]||s),o.Both):o.EntitiesOnly:o.None}function F(a,n){let t=n.ids.reduce((i,s)=>{let u=a(n.entities[s]);return u!==n.entities[s]&&i.push({id:s,changes:u}),i},[]).filter(({id:i})=>i in n.entities);return v(t,n)}function T({map:a,id:n},e){let t=e.entities[n];if(!t)return o.None;let i=a(t);return B({id:n,changes:i},e)}function C(a,n){return A([a],n)}function A(a,n){let e=[],t=[];for(let u of a){let f=b(u,r);f in n.entities?t.push({id:f,changes:u}):e.push(u)}let i=v(t,n),s=l(e,n);switch(!0){case(s===o.None&&i===o.None):return o.None;case(s===o.Both||i===o.Both):return o.Both;default:return o.EntitiesOnly}}return{removeAll:S,addOne:d(c),addMany:d(l),setAll:d(y),setOne:d(h),setMany:d(m),updateOne:d(B),updateMany:d(v),upsertOne:d(C),upsertMany:d(A),removeOne:d(p),removeMany:d(E),map:d(F),mapOne:d(T)}}function Q(r,c){let{removeOne:l,removeMany:y,removeAll:h}=D(r);function m(e,t){return p([e],t)}function p(e,t){let i=e.filter(s=>!(b(s,r)in t.entities));return i.length===0?o.None:(n(i,t),o.Both)}function E(e,t){return t.entities={},t.ids=[],p(e,t),o.Both}function S(e,t){let i=b(e,r);return i in t.entities?(t.ids=t.ids.filter(s=>s!==i),n([e],t),o.Both):m(e,t)}function R(e,t){let i=e.map(s=>S(s,t));switch(!0){case i.some(s=>s===o.Both):return o.Both;case i.some(s=>s===o.EntitiesOnly):return o.EntitiesOnly;default:return o.None}}function B(e,t){return F([e],t)}function v(e,t,i){if(!(t.id in i.entities))return!1;let s=i.entities[t.id],u=Object.assign({},s,t.changes),f=b(u,r);return delete i.entities[t.id],e.push(u),f!==t.id}function F(e,t){let i=[],s=e.filter(u=>v(i,u,t)).length>0;if(i.length===0)return o.None;{let u=t.ids,f=[];return t.ids=t.ids.filter((g,O)=>g in t.entities?!0:(f.push(O),!1)),n(i,t),!s&&f.every(g=>t.ids[g]===u[g])?o.EntitiesOnly:o.Both}}function T(e,t){let i=t.ids.reduce((s,u)=>{let f=e(t.entities[u]);return f!==t.entities[u]&&s.push({id:u,changes:f}),s},[]);return F(i,t)}function C({map:e,id:t},i){let s=i.entities[t];if(!s)return o.None;let u=e(s);return B({id:t,changes:u},i)}function A(e,t){return a([e],t)}function a(e,t){let i=[],s=[];for(let g of e){let O=b(g,r);O in t.entities?s.push({id:O,changes:g}):i.push(g)}let u=F(s,t),f=p(i,t);switch(!0){case(f===o.None&&u===o.None):return o.None;case(f===o.Both||u===o.Both):return o.Both;default:return o.EntitiesOnly}}function n(e,t){e.sort(c);let i=[],s=0,u=0;for(;s<e.length&&u<t.ids.length;){let f=e[s],g=b(f,r),O=t.ids[u],q=t.entities[O];c(f,q)<=0?(i.push(g),s++):(i.push(O),u++)}s<e.length?t.ids=i.concat(e.slice(s).map(r)):t.ids=i.concat(t.ids.slice(u)),e.forEach((f,g)=>{t.entities[r(f)]=f})}return{removeOne:l,removeMany:y,removeAll:h,addOne:d(m),updateOne:d(B),upsertOne:d(A),setAll:d(E),setOne:d(S),setMany:d(R),addMany:d(p),updateMany:d(F),upsertMany:d(a),map:d(T),mapOne:d(C)}}function j(r={}){let{selectId:c,sortComparer:l}={selectId:r.selectId??(p=>p.id),sortComparer:r.sortComparer??!1},y=G(),h=J(),m=l?Q(c,l):D(c);return x(x(x({selectId:c,sortComparer:l},y),h),m)}var K=j({selectId:r=>r.activityPubId||r.id}),W={ids:[],entities:{}},yt=w(W,I(N.loadModelSuccess,(r,{data:c})=>K.upsertOne(c,r)));var X="models",Y=V(X),Z=K.getSelectors(),_=M(Y,Z.selectEntities),bt=M(_,r=>Object.values(r)),Ot=r=>M(Y,c=>c?.entities?.[r]??null);var tt=j({selectId:r=>r.activityPubId||r.id}),et={ids:[],entities:{}},At=w(et,I(N.loadFlashcardSuccess,(r,{data:c})=>tt.upsertOne(c,r)));export{yt as a,bt as b,Ot as c,tt as d,At as e,L as f};
