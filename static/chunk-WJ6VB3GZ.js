import{a as K}from"./chunk-XG3JPJ5H.js";import{Dd as g,Ed as C,Fc as U,Gd as T,Hd as L}from"./chunk-BDC5ZKWJ.js";import{a as x,b as k}from"./chunk-2NFLSA4Y.js";function z(){return{ids:[],entities:{}}}function G(){function o(d={}){return Object.assign(z(),d)}return{getInitialState:o}}function H(){function o(d){let l=y=>y.ids,p=y=>y.entities,h=g(l,p,(y,B)=>y.map(E=>B[E])),M=g(l,y=>y.length);return d?{selectIds:g(d,l),selectEntities:g(d,p),selectAll:g(d,h),selectTotal:g(d,M)}:{selectIds:l,selectEntities:p,selectAll:h,selectTotal:M}}return{getSelectors:o}}var r=function(o){return o[o.EntitiesOnly=0]="EntitiesOnly",o[o.Both=1]="Both",o[o.None=2]="None",o}(r||{});function a(o){return function(l,p){let h={ids:[...p.ids],entities:x({},p.entities)},M=o(l,h);return M===r.Both?Object.assign({},p,h):M===r.EntitiesOnly?k(x({},p),{entities:h.entities}):p}}function O(o,d){let l=d(o);return U()&&l===void 0&&console.warn("@ngrx/entity: The entity passed to the `selectId` implementation returned undefined.","You should probably provide your own `selectId` implementation.","The entity that was passed:",o,"The `selectId` implementation:",d.toString()),l}function R(o){function d(u,n){let t=O(u,o);return t in n.entities?r.None:(n.ids.push(t),n.entities[t]=u,r.Both)}function l(u,n){let t=!1;for(let e of u)t=d(e,n)!==r.None||t;return t?r.Both:r.None}function p(u,n){return n.ids=[],n.entities={},l(u,n),r.Both}function h(u,n){let t=O(u,o);return t in n.entities?(n.entities[t]=u,r.EntitiesOnly):(n.ids.push(t),n.entities[t]=u,r.Both)}function M(u,n){let t=u.map(e=>h(e,n));switch(!0){case t.some(e=>e===r.Both):return r.Both;case t.some(e=>e===r.EntitiesOnly):return r.EntitiesOnly;default:return r.None}}function y(u,n){return B([u],n)}function B(u,n){let e=(u instanceof Array?u:n.ids.filter(i=>u(n.entities[i]))).filter(i=>i in n.entities).map(i=>delete n.entities[i]).length>0;return e&&(n.ids=n.ids.filter(i=>i in n.entities)),e?r.Both:r.None}function E(u){return Object.assign({},u,{ids:[],entities:{}})}function w(u,n,t){let e=t.entities[n.id],i=Object.assign({},e,n.changes),s=O(i,o),c=s!==n.id;return c&&(u[n.id]=s,delete t.entities[n.id]),t.entities[s]=i,c}function A(u,n){return S([u],n)}function S(u,n){let t={};return u=u.filter(i=>i.id in n.entities),u.length>0?u.filter(s=>w(t,s,n)).length>0?(n.ids=n.ids.map(s=>t[s]||s),r.Both):r.EntitiesOnly:r.None}function N(u,n){let e=n.ids.reduce((i,s)=>{let c=u(n.entities[s]);return c!==n.entities[s]&&i.push({id:s,changes:c}),i},[]).filter(({id:i})=>i in n.entities);return S(e,n)}function I({map:u,id:n},t){let e=t.entities[n];if(!e)return r.None;let i=u(e);return A({id:n,changes:i},t)}function j(u,n){return v([u],n)}function v(u,n){let t=[],e=[];for(let c of u){let f=O(c,o);f in n.entities?e.push({id:f,changes:c}):t.push(c)}let i=S(e,n),s=l(t,n);switch(!0){case(s===r.None&&i===r.None):return r.None;case(s===r.Both||i===r.Both):return r.Both;default:return r.EntitiesOnly}}return{removeAll:E,addOne:a(d),addMany:a(l),setAll:a(p),setOne:a(h),setMany:a(M),updateOne:a(A),updateMany:a(S),upsertOne:a(j),upsertMany:a(v),removeOne:a(y),removeMany:a(B),map:a(N),mapOne:a(I)}}function J(o,d){let{removeOne:l,removeMany:p,removeAll:h}=R(o);function M(t,e){return y([t],e)}function y(t,e){let i=t.filter(s=>!(O(s,o)in e.entities));return i.length===0?r.None:(n(i,e),r.Both)}function B(t,e){return e.entities={},e.ids=[],y(t,e),r.Both}function E(t,e){let i=O(t,o);return i in e.entities?(e.ids=e.ids.filter(s=>s!==i),n([t],e),r.Both):M(t,e)}function w(t,e){let i=t.map(s=>E(s,e));switch(!0){case i.some(s=>s===r.Both):return r.Both;case i.some(s=>s===r.EntitiesOnly):return r.EntitiesOnly;default:return r.None}}function A(t,e){return N([t],e)}function S(t,e,i){if(!(e.id in i.entities))return!1;let s=i.entities[e.id],c=Object.assign({},s,e.changes),f=O(c,o);return delete i.entities[e.id],t.push(c),f!==e.id}function N(t,e){let i=[],s=t.filter(c=>S(i,c,e)).length>0;if(i.length===0)return r.None;{let c=e.ids,f=[];return e.ids=e.ids.filter((m,b)=>m in e.entities?!0:(f.push(b),!1)),n(i,e),!s&&f.every(m=>e.ids[m]===c[m])?r.EntitiesOnly:r.Both}}function I(t,e){let i=e.ids.reduce((s,c)=>{let f=t(e.entities[c]);return f!==e.entities[c]&&s.push({id:c,changes:f}),s},[]);return N(i,e)}function j({map:t,id:e},i){let s=i.entities[e];if(!s)return r.None;let c=t(s);return A({id:e,changes:c},i)}function v(t,e){return u([t],e)}function u(t,e){let i=[],s=[];for(let m of t){let b=O(m,o);b in e.entities?s.push({id:b,changes:m}):i.push(m)}let c=N(s,e),f=y(i,e);switch(!0){case(f===r.None&&c===r.None):return r.None;case(f===r.Both||c===r.Both):return r.Both;default:return r.EntitiesOnly}}function n(t,e){t.sort(d);let i=[],s=0,c=0;for(;s<t.length&&c<e.ids.length;){let f=t[s],m=O(f,o),b=e.ids[c],q=e.entities[b];d(f,q)<=0?(i.push(m),s++):(i.push(b),c++)}s<t.length?e.ids=i.concat(t.slice(s).map(o)):e.ids=i.concat(e.ids.slice(c)),t.forEach((f,m)=>{e.entities[o(f)]=f})}return{removeOne:l,removeMany:p,removeAll:h,addOne:a(M),updateOne:a(A),upsertOne:a(v),setAll:a(B),setOne:a(E),setMany:a(w),addMany:a(y),updateMany:a(N),upsertMany:a(u),map:a(I),mapOne:a(j)}}function V(o={}){let{selectId:d,sortComparer:l}={selectId:o.selectId??(y=>y.id),sortComparer:o.sortComparer??!1},p=G(),h=H(),M=l?J(d,l):R(d);return x(x(x({selectId:d,sortComparer:l},p),h),M)}var F=V({selectId:o=>o.activityPubId||o.id}),P={ids:[],entities:{}},oe=L(P,T(K.loadModelSuccess,(o,{data:d})=>F.upsertOne(d,o)),T(K.loadModelsSuccess,(o,{data:d})=>F.setAll(d,o)));var Q="models",Y=C(Q),W=F.getSelectors(),X=g(Y,W.selectEntities),ae=g(X,o=>Object.values(o)),le=o=>g(Y,d=>d?.entities?.[o]??null);export{V as a,oe as b,ae as c,le as d};
